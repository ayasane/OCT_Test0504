<!DOCTYPE html>
<html>
<head>
    <script src="src/jspsych-6.1.0/jspsych.js"></script>
    <script src="src/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="src/jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
    <script src="src/jspsych-psychophysics-2.0/jspsych-psychophysics.js"></script>
    <link rel="stylesheet" href="src/jspsych-6.1.0/css/jspsych.css"></link>
</head>

<body bgcolor="#000", text="#FFF">
    <script type="text/javascript">

      /* 課題に関するコードを以下に書く */
      var fullscreen = {
        type: 'fullscreen',
        message: '<p>以下のボタンをクリックすると，画面は全画面表示に切り替わります。全画面表示を止めたい場合はEscキーを押してください。</p>',
        button_label: "全画面表示に切り替え",
        fullscreen_mode: true
      };
      var welcome = {
        type: "html-keyboard-response",
        stimulus: "木曜日は少し疲れてきますね！"
      };

      /* タイムラインの設定 */
      var timeline = [];
      /* timeline.push(fullscreen); */
      timeline.push(welcome);

      var line_blue = {
        obj_type: 'line',
        startX: 800, // location in the canvas
        startY: 400,
        angle:  90,
        line_length: 100,
        line_width: 3,
        line_color: 'blue',
      }

      var line_red = {
        obj_type: 'line',
        startX: 200, // location in the canvas
        startY: 400,
        angle:  0,
        line_length: 100,
        line_width: 3,
        line_color: 'red',
      }

      /* 回転の教示 */
      var text_rotate = {
       obj_type: 'text',
       startX: 120,
       startY: 680,
       content: '青い線を回転させるために\nボタンを押してください',
       font: "16px 'Arial'",
       text_color: 'white',
      }

      /* 終了の教示 */
      var text_finish = {
       obj_type: 'text',
       startX: 880,
       startY: 680,
       content: '２つの線の方向が同じになったら\n「終了」を押してください',
       font: "16px 'Arial'",
       text_color: 'white',
      }


      var trial = {
          type: 'psychophysics',
          response_type: 'button',
          stimuli: [line_blue,line_red,text_rotate,text_finish],
          button_choices: ['<div style="position: absolute; top: 80%; right: 32%"><img src="img/task05_LOT/img_right.png" width="100px"/></div>',
          '<div style="position: absolute; top: 80%; right: 62%"><img src="img/task05_LOT/img_left.png" width="100px"/></div>',
          '<div style="position: absolute; top: 80%; right: 47%"><img src="img/task05_LOT/img_fin.png" width="100px"/></div>'],
          button_html:  '<button class="jspsych-btn">%choice%</button>',
          canvas_width: 1000,
          canvas_height: 800,
          background_color: "black",
      }

      var stimli_list = [
        {line_red_angle: 60, line_blue_angle:84, line_blue_length:100},
        {line_red_angle: 150, line_blue_angle:18, line_blue_length:50},
        {line_red_angle: 12, line_blue_angle:168, line_blue_length:25},
      ];


      var trial_n = 2;
      for(var trial_i = 0; trial_i < (trial_n+1); trial_i++) {

        line_blue.angle = stimli_list[trial_i]['line_blue_angle'];
        line_blue.line_length = stimli_list[trial_i]['line_blue_length'];
        line_red.angle = stimli_list[trial_i]['line_red_angle'];

        var rotate_node = {
          timeline: [trial],
          loop_function: function(data){
            var last_select = jsPsych.data.get().last(1).values()[0].button_pressed;
            if(last_select == "0"){
              line_blue.angle = line_blue.angle + 6;
              return true;
            } else if(last_select == "1"){
              line_blue.angle = line_blue.angle - 6;
              return true;
            } else {
              if(trial_i < trial_n){
                line_blue.angle = stimli_list[trial_i+1]['line_blue_angle'];
                line_blue.line_length = stimli_list[trial_i+1]['line_blue_length'];
                line_red.angle = stimli_list[trial_i+1]['line_red_angle'];
                return false;
              }
                return false;
            }
          },
        };
        timeline.push(rotate_node);
      }


      /* 課題開始 */
      jsPsych.init({
        timeline: timeline,
        on_finish: function() {
          jsPsych.data.displayData();
        }
      });

    </script>
</body>
</html>
