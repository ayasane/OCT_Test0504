<!DOCTYPE html>
<html>
  <head>
      <title>VOLT experiment</title>
      <script src="src/jspsych-6.1.0/jspsych.js"></script>
      <script src="src/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
      <script src="src/jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
      <script src="src/jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
      <script src="src/jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
      <script src="src/jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
      <link rel="stylesheet" href="src/jspsych-6.1.0/css/jspsych.css"></link>
  </head>

<body>
    <script type="text/javascript">

      /* 課題に関するコードを以下に書く */
      var fullscreen = {
        type: 'fullscreen',
        message: '<p>以下のボタンをクリックすると，画面は全画面表示に切り替わります。全画面表示を止めたい場合はEscキーを押してください。</p>',
        button_label: "全画面表示に切り替え",
        fullscreen_mode: true
      };


      var welcome = {
        type: "html-button-response",
        stimulus: '記憶課題です。'+
        '<br><br>この課題は下記の２つのフェーズに分かれています。' +
        '<br>[フェーズ１] ５秒ずつ提示される１０枚の図形を記憶する。'+
        '<br>[フェーズ２] ２０枚の画像が提示されるので，記憶した画像か，新しい図形か，を判断する。'+
        '<br><br>次のページから課題が始まります。',
        choices: ['次へ']
      };


      var learning_phase = {
        type: "html-button-response",
        stimulus: '【フェーズ１】'+
        '<br><b>これから，５秒ずつ１０個の画像が出てくるので記憶してください。</b>',
        choices: ['スタート']
      };

      var test_phase = {
        type: "html-button-response",
        stimulus: '【フェーズ２】'+
        '<br><br>これから，２０枚の画像が１枚ずつ出てきます。'+
        '<br>先ほど覚えた画像であれば <b>F キー</b> を，新しい画像であれば <b>J キー</b>を押して下さい。'+
        '<br><br>正解かどうかのフィードバックはありません。'+
        '<br><br>制限時間はありませんので，自分のペースで進んでください。',
        choices: ['スタート']
      };

/*
参考URL: https://www.jspsych.org/overview/timeline/
timelineVariable の２つ目の引数について：　https://www.jspsych.org/core_library/jspsych-core/
*/


      var learning_procedure = {
          timeline: [
              {
                  type: 'html-keyboard-response',
                  stimulus: '+',
                  choices: jsPsych.NO_KEYS,
                  trial_duration: 500
              },
              {
                  type: 'image-keyboard-response',
                  stimulus: jsPsych.timelineVariable('stim1'),
                  choices: jsPsych.NO_KEYS,
                  stimulus_height:200,
                  trial_duration: 2000
              }
          ],
          timeline_variables: [
              { stim1: 'img/task02_VOLT/s3a.JPG' },
              { stim1: 'img/task02_VOLT/s3b.JPG' },
              { stim1: 'img/task02_VOLT/s4a.JPG' },
              { stim1: 'img/task02_VOLT/s4b.JPG' },
          ],
          randomize_order: true
      }

      var sumcorrect = 0;
      var recognitionOld = 0;
      var recognitionNew = 0;
      var distinction = 0;

      var test_procedure = {
          timeline: [
              {
                  type: 'html-keyboard-response',
                  stimulus: '+',
                  choices: jsPsych.NO_KEYS,
                  trial_duration: 500
              },
              {
                  type: 'image-keyboard-response',
                  stimulus: jsPsych.timelineVariable('stim2'),
                  choices: jsPsych.NO_KEYS,
                  prompt: '<br>記憶した画像 [ <b>F</b> ]　/　新しい画像 [ <b>J</b> ]',
                  stimulus_height:200,
                  choices: ['f', 'j'],
                  correct: jsPsych.timelineVariable('correct'),
                  on_finish: function(data,timelineVariable){
                    if(jsPsych.timelineVariable('correct',true) == 'old' && data.key_press == 70 ){
                      data.recognitionOld = 1;
                      data.recognitionNew = 'NA';
                      data.distinction = 1;
                      sumcorrect = sumcorrect + 1;
                    } else if (jsPsych.timelineVariable('correct',true) == 'new' && data.key_press == 74 ){
                      data.recognitionOld = 'NA';
                      data.recognitionNew = 1;
                      data.distinction = 1;
                      sumcorrect = sumcorrect + 1;
                    } else if (jsPsych.timelineVariable('correct',true) == 'old' && data.key_press == 74 ){
                      data.recognitionOld = 0;
                      data.recognitionNew = 'NA';
                      data.distinction = 0;
                      sumcorrect = sumcorrect;
                    } else if (jsPsych.timelineVariable('correct',true) == 'new' && data.key_press == 70 ){
                      data.recognitionOld = 'NA';
                      data.recognitionNew = 0;
                      data.distinction = 0;
                      sumcorrect = sumcorrect;
                    } else {
                      data.recognitionOld = 'NA';
                      data.recognitionNew = 'NA';
                      data.distinction = 'NA';
                      sumcorrect = sumcorrect;
                    }
                  }
              }
          ],
          timeline_variables: [
              { stim2: 'img/task02_VOLT/s3a.JPG', correct: 'old'},
              { stim2: 'img/task02_VOLT/s3b.JPG', correct: 'old'},
              { stim2: 'img/task02_VOLT/s4a.JPG', correct: 'old'},
              { stim2: 'img/task02_VOLT/s4b.JPG', correct: 'old'},
              { stim2: 'img/task02_VOLT/s3c.JPG', correct: 'new'},
              { stim2: 'img/task02_VOLT/s3d.JPG', correct: 'new'},
              { stim2: 'img/task02_VOLT/s4c.JPG', correct: 'new'},
              { stim2: 'img/task02_VOLT/s4d.JPG', correct: 'new'},
          ],
          randomize_order: true
      };

      var final_page = {
        type: "html-button-response",
        stimulus: function(){
          return 'お疲れ様でした！'+
          '<br><br>全20問中　' + sumcorrect + '　問正解でした。<br><br>'
        },
        choices: ['終わる'],
      };

      /* タイムラインの設定 */

      var timeline = [];
      timeline.push(fullscreen);
      timeline.push(welcome,learning_phase,learning_procedure);
      timeline.push(test_phase,test_procedure);
      timeline.push(final_page);


      /* 課題開始 */
      jsPsych.init({
        timeline: timeline,
        on_finish: function() {
          jsPsych.data.displayData();
        }
      });

    </script>
</body>
</html>
